)
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
city_sources <- Decile_vs_emission_by_variable(
active_stack = long_chunk,
chosen_decile = IMD,
chosen_grouping = Emission_source,
xaxis = "IMD Decile",
yaxis = "NOx emissions",
title = paste0("Source breakdown for ",targets),
chosen_variable = emissions
)
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
city_sources <- Decile_vs_emission_by_variable(
active_stack = long_chunk,
chosen_decile = IMD,
chosen_grouping = Emission_source,
xaxis = "IMD Decile",
yaxis = "NOx emissions",
title = paste0("Source breakdown for ",targets),
chosen_variable = emissions
)
city_sources
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
city_sources <- Decile_vs_emission_by_variable(
active_stack = long_chunk,
chosen_decile = IMD,
chosen_grouping = Emission_source,
xaxis = "IMD Decile",
yaxis = "NOx emissions",
title = paste0("Source breakdown for ",targets),
chosen_variable = emissions
)
city_sources
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
city_sources <- Decile_vs_emission_by_variable(
active_stack = long_chunk,
chosen_decile = IMD,
chosen_grouping = Emission_source,
xaxis = "IMD Decile",
yaxis = "NOx emissions",
title = paste0("Source breakdown for ",targets),
chosen_variable = emissions
)
city_sources
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
city_sources <- Decile_vs_emission_by_variable(
active_stack = long_chunk,
chosen_decile = IMD,
chosen_grouping = Emission_source,
xaxis = "IMD Decile",
yaxis = "NOx emissions",
title = paste0("Source breakdown for ",targets),
chosen_variable = emissions
)
city_sources
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
city_sources <- Decile_vs_emission_by_variable(
active_stack = long_chunk,
chosen_decile = IMD,
chosen_grouping = Emission_source,
xaxis = "IMD Decile",
yaxis = "NOx emissions",
title = paste0("Source breakdown for ",targets),
chosen_variable = emissions
)
city_sources
raster_path <-  "Data/pm2.5_rasters_2019"
shapefile_path <- "Data/2011_LSOA_shapefile_20m_generalised"
data_folder <- "Data/LSOA_statistics"
pollutant_data_name <- "pm2_5"
year <- 2019
pollutant <- "PM2.5"
create_prawns(raster_path = raster_path,
shapefile_path = shapefile_path,
data_folder = data_folder,
pollutant_data_name = pollutant_data_name,
year = year,
pollutant = pollutant)
create_prawns(raster_path = raster_path,
shapefile_path = shapefile_path,
data_path = data_folder,
pollutant_data_name = pollutant_data_name,
year = year,
pollutant = pollutant)
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
source("~/GitHub/PRAWNS/R/bulk_processor.R")
#work out the version pf the package for reproducibility, calculating it here makes the code more streamlined
iteration <- packageVersion("PRAWNS")
View(iteration)
class(iteration)
as.character(iteration)
source("~/GitHub/PRAWNS/R/bulk_processor.R")
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
#work out the version pf the package for reproducibility, calculating it here makes the code more streamlined
iteration <- as.character(packageVersion("PRAWNS"))
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration)
raster_path <- "Data/pm2.5_rasters_2019"
shapefile_path <-  "Data/2011_LSOA_shapefile_20m_generalised"
data_folder <-  "Data/LSOA_statistics"
pollutant_data_name <-  "pm2_5"
year <-  2019
pollutant <-  "PM2.5"
iteration <- "0.4.0"
prawn_path <- "PM2.5_emissions_in_2019_v0.3.0/PRAWN.csv"
#work out the version pf the package for reproducibility, calculating it here makes the code more streamlined
iteration <- as.character(packageVersion("PRAWNS"))
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration)
#This loop creates three different outputs using different data: the base data, the data without london and the data with na values replaced with 0
for ( index in c(1:3)){
#Create the folder for the results using the raw data
if (index==1){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration)
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#The base path remains unchanged and is used to fetch a raw copy of the prawn for processed versions
raw_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#create the base prawn for this function, it will also be used by iterations 2 and 3 but filtered
create_prawns(
raster_path= raster_path,
shapefile_path = shapefile_path,
data_path= list.files(data_folder),
pollutant_data_name = pollutant_data_name,
year=year,
pollutant=pollutant,
output_path = prawn_path)
}
#create the results without London,
if (index==2){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/Londonless")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#Create the filtered data without London and save it at prawn_path
londonless_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
filter(TCITY15NM!="London")
#Write the filtered prawn
write.csv(x = londonless_prawn,
file=prawn_path)
}
if (index==3){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/na is 0")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(list("Agricultural"=0,"Domestic combustion"=0,"Energy production"=0,
"Industrial combustion"=0,"Industrial production"=0,"Natural"=0,
"Offshore"=0,"Other transport and mobile machinery"=0,"Road transport"=0,"Solvents"=0,"Total"=0
,"Total_no_points"=0,"Waste treatment and disposal"=0))
write.csv(x = na_0_prawn,
file=prawn_path)
}
#Make and save a graph showing a summary of the pollutants
source_breakdown <- source_summary(prawn_path=prawn_path,
pollutant=pollutant,
year=year)
ggsave(filename= paste0(proc_tag,"/",pollutant," source summary.png"),
plot=source_breakdown,
device="png")
#Make and save a graph where the sources are all faceted
source_facets <- faceted_sources(prawn_path = prawn_path,
pollutant=pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted sources.png"),
plot=source_facets,
device="png")
#Make and save a graph showing IMD based inequality for each RUC code
RUC_breakdown <- RUC_IMD(prawn_path = prawn_path,
pollutant=pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," RUC breakdown.png"),
plot=RUC_breakdown[[1]],
device="png")
ggsave(filename= paste0(proc_tag,"/",pollutant," RUC populationbreakdown.png"),
plot=RUC_breakdown[[2]],
device="png")
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted by city.png"),
plot=city_facets,
device="png")
#Facet the mean and median pollutant levels by county/unitary authority
area_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted by area.png"),
plot=area_facets,
device="png")
#Plot the average pollutant vs average IMD grouped by county/ua
avg_imd_pol <- area_IMD_vs_pol(prawn_path=prawn_path,
pollutant = pollutant,
area_type = "Area")
ggsave(filename= paste0(proc_tag,"/",pollutant," average vs average IMD by area.png"),
plot=avg_imd_pol,
device="png")
#calculate and record the difference between the mean and median points and regression lines at deciles 1 and 10
numbers <- stat_wrangler(prawn_path = prawn_path,
)
write.csv(x=numbers,
file=paste0(proc_tag,"/difference between deciles.csv"))
pie <- gradient_pie(pollutant = pollutant,
#The input path is the same as the output file for numbers
input_path=paste0(proc_tag,"/difference between deciles.csv"))
ggsave(filename= paste0(proc_tag,"/pie chart of how ",pollutant," sources contribute to the inequality gradient.png"),
plot=pie,
device="png")
#close the for loop
}
source("~/GitHub/PRAWNS/R/Decile_vs_emission_by_variable.R")
#This loop creates three different outputs using different data: the base data, the data without london and the data with na values replaced with 0
for ( index in c(1:3)){
#Create the folder for the results using the raw data
if (index==1){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration)
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#The base path remains unchanged and is used to fetch a raw copy of the prawn for processed versions
raw_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#create the base prawn for this function, it will also be used by iterations 2 and 3 but filtered
create_prawns(
raster_path= raster_path,
shapefile_path = shapefile_path,
data_path= list.files(data_folder),
pollutant_data_name = pollutant_data_name,
year=year,
pollutant=pollutant,
output_path = prawn_path)
}
#create the results without London,
if (index==2){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/Londonless")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#Create the filtered data without London and save it at prawn_path
londonless_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
filter(TCITY15NM!="London")
#Write the filtered prawn
write.csv(x = londonless_prawn,
file=prawn_path)
}
if (index==3){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/na is 0")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(list("Agricultural"=0,"Domestic combustion"=0,"Energy production"=0,
"Industrial combustion"=0,"Industrial production"=0,"Natural"=0,
"Offshore"=0,"Other transport and mobile machinery"=0,"Road transport"=0,"Solvents"=0,"Total"=0
,"Total_no_points"=0,"Waste treatment and disposal"=0))
write.csv(x = na_0_prawn,
file=prawn_path)
}
#Make and save a graph showing a summary of the pollutants
source_breakdown <- source_summary(prawn_path=prawn_path,
pollutant=pollutant,
year=year)
ggsave(filename= paste0(proc_tag,"/",pollutant," source summary.png"),
plot=source_breakdown,
device="png")
#Make and save a graph where the sources are all faceted
source_facets <- faceted_sources(prawn_path = prawn_path,
pollutant=pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted sources.png"),
plot=source_facets,
device="png")
#Make and save a graph showing IMD based inequality for each RUC code
RUC_breakdown <- RUC_IMD(prawn_path = prawn_path,
pollutant=pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," RUC breakdown.png"),
plot=RUC_breakdown[[1]],
device="png")
ggsave(filename= paste0(proc_tag,"/",pollutant," RUC populationbreakdown.png"),
plot=RUC_breakdown[[2]],
device="png")
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted by city.png"),
plot=city_facets,
device="png")
#Facet the mean and median pollutant levels by county/unitary authority
area_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted by area.png"),
plot=area_facets,
device="png")
#Plot the average pollutant vs average IMD grouped by county/ua
avg_imd_pol <- area_IMD_vs_pol(prawn_path=prawn_path,
pollutant = pollutant,
area_type = "Area")
ggsave(filename= paste0(proc_tag,"/",pollutant," average vs average IMD by area.png"),
plot=avg_imd_pol,
device="png")
#calculate and record the difference between the mean and median points and regression lines at deciles 1 and 10
numbers <- stat_wrangler(prawn_path = prawn_path,
)
write.csv(x=numbers,
file=paste0(proc_tag,"/difference between deciles.csv"))
pie <- gradient_pie(pollutant = pollutant,
#The input path is the same as the output file for numbers
input_path=paste0(proc_tag,"/difference between deciles.csv"))
ggsave(filename= paste0(proc_tag,"/pie chart of how ",pollutant," sources contribute to the inequality gradient.png"),
plot=pie,
device="png")
#close the for loop
}
source("~/GitHub/PRAWNS/R/faceted_plot.R")
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
city_facets
source("~/GitHub/PRAWNS/R/faceted_plot.R")
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
city_facets
source("~/GitHub/PRAWNS/R/area_summary.R")
source("~/GitHub/PRAWNS/R/area_summary.R")
#' @keywords heatmap, graph,
#' @export
#' @examples
#' area_summary()
#'
area_summary <- function(prawn_path,
shape_path,
targets,
pollutant,
output_path=FALSE){}
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
city_facets
#Reads in the demographic and pollution data
raw_data <- read.csv(file=prawn_path,
row.names=1,
check.names=FALSE) %>% tibble()
#Reads in the shapefiles
raw_shapefile <- st_read(shape_path)
shapefile_path <-  "Data/2011_LSOA_shapefile_20m_generalised"
shape_path <-  "Data/2011_LSOA_shapefile_20m_generalised"
#Reads in the shapefiles
raw_shapefile <- st_read(shape_path)
source("~/GitHub/PRAWNS/R/faceted_plot.R")
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
faceted_plot()
prawn_path <- "PM2.5_emissions_in_2019_v0.3.0/PRAWN.csv"
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
city_facets
source("~/GitHub/PRAWNS/R/faceted_plot.R")
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
city_facets
warnings()
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
city_facets
source("~/GitHub/PRAWNS/R/RUC_IMD.R")
#Make and save a graph showing IMD based inequality for each RUC code
RUC_breakdown <- RUC_IMD(prawn_path = prawn_path,
pollutant=pollutant)
RUC_breakdown
source("~/GitHub/PRAWNS/R/faceted_sources.R")
#Make and save a graph where the sources are all faceted
source_facets <- faceted_sources(prawn_path = prawn_path,
pollutant=pollutant)
source_facets
source("~/GitHub/PRAWNS/R/faceted_sources.R")
#Make and save a graph where the sources are all faceted
source_facets <- faceted_sources(prawn_path = prawn_path,
pollutant=pollutant)
source_facets
#Plot the average pollutant vs average IMD grouped by county/ua
avg_imd_pol <- area_IMD_vs_pol(prawn_path=prawn_path,
pollutant = pollutant,
area_type = "Area")
avg_imd_pol
setwd("~/Github/PRAWNS")
document()
document()
library(devtools)
library(roxygen2)
setwd("~/Github/PRAWNS")
document()
library(tidyverse)
document()
source("~/GitHub/PRAWNS/R/area_summary.R")
document()
document()
detach("package:PRAWNS", unload = TRUE)
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
library(PRAWNS)
setwd("~/GitHub/Data-analysis-with-PRAWNS-demo")
Startup()
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
iteration <- "0.4.0"
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
source("~/GitHub/PRAWNS/R/bulk_processor.R")
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
setwd("~/Github/PRAWNS")
document()
document()
detach("package:PRAWNS", unload = TRUE)
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
library(PRAWNS)
setwd("~/GitHub/Data-analysis-with-PRAWNS-demo")
Startup()
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
)
warnings()
library(devtools)
library(roxygen2)
setwd("~/Github/PRAWNS")
