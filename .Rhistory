proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration)
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#The base path remains unchanged and is used to fetch a raw copy of the prawn for processed versions
raw_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#create the base prawn for this function, it will also be used by iterations 2 and 3 but filtered
create_prawns(
raster_path= raster_path,
shapefile_path = shapefile_path,
data_path= list.files(data_folder),
pollutant_data_name = pollutant_data_name,
year=year,
pollutant=pollutant,
output_path = prawn_path)
}
#Create the folder for the results using the raw data
if (index==1){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration)
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#The base path remains unchanged and is used to fetch a raw copy of the prawn for processed versions
raw_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#create the base prawn for this function, it will also be used by iterations 2 and 3 but filtered
create_prawns(
raster_path= raster_path,
shapefile_path = shapefile_path,
data_path= list.files(data_folder),
pollutant_data_name = pollutant_data_name,
year=year,
pollutant=pollutant,
output_path = prawn_path)
}
source("~/GitHub/PRAWNS/R/create_prawns.R")
#Create the folder for the results using the raw data
if (index==1){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration)
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#The base path remains unchanged and is used to fetch a raw copy of the prawn for processed versions
raw_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#create the base prawn for this function, it will also be used by iterations 2 and 3 but filtered
create_prawns(
raster_path= raster_path,
shapefile_path = shapefile_path,
data_path= list.files(data_folder),
pollutant_data_name = pollutant_data_name,
year=year,
pollutant=pollutant,
output_path = prawn_path)
}
#create the results without London,
if (index==2){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/Londonless")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#Create the filtered data without London and save it at prawn_path
londonless_prawn <- read.csv(raw_path) %>%
tibble() %>%
filter(TCITY15NM!="London")
#Write the filtered prawn
write.csv(x = londonless_prawn,
file=prawn_path)
}
if (index==3){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/na is 0")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path) %>%
tibble() %>%
replace(is.na(.),0)
write.csv(x = na_0_prawn,
file=prawn_path)
}
#Make and save a graph showing a summary of the pollutants
source_breakdown <- source_summary(prawn_path=prawn_path,
pollutant=pollutant,
year=year)
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
detach("package:PRAWNS", unload = TRUE)
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
library(roxygen2)
library(devtools)
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
setwd("~/GitHub/PRAWNS")
document()
document()
document()
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
library(PRAWNS)
detach("package:PRAWNS", unload = TRUE)
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
setwd("~/GitHub/PRAWNS")
document()
document()
document()
document()
library(PRAWNS)
detach("package:PRAWNS", unload = TRUE)
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
library(PRAWNS)
startup()
Startup()
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
iteration="0.3.0")
setwd("~/GitHub/Data-analysis-with-PRAWNS-demo")
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
iteration="0.3.0")
last_error()
detach("package:PRAWNS", unload = TRUE)
document(pkg = "~/Github/PRAWNS")
document(pkg = as.package("~/Github/PRAWNS"))
setwd("~/GitHub/PRAWNS")
document()
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
library(PRAWNS)
detach("package:PRAWNS", unload = TRUE)
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
library(PRAWNS)
setwd("~/GitHub/Data-analysis-with-PRAWNS-demo")
setwd("~/GitHub/Data-analysis-with-PRAWNS-demo")
Startup()
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
iteration="0.3.0")
source("~/GitHub/PRAWNS/R/bulk_processor.R")
detach("package:PRAWNS", unload = TRUE)
setwd("~/Github/PRAWNS")
install.packages("~/Github/PRAWNS", repos=NULL, type="source")
library(PRAWNS)
setwd("~/GitHub/Data-analysis-with-PRAWNS-demo")
Startup()
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
iteration="0.3.0")
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() #%>%
raster_path <- "Data/pm2.5_rasters_2019"
shapefile_path <-  "Data/2011_LSOA_shapefile_20m_generalised"
data_folder <-  "Data/LSOA_statistics"
pollutant_data_name <-  "pm2_5"
year <-  2019
pollutant <-  "PM2.5"
iteration <- "0.3.0"
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration)
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#The base path remains unchanged and is used to fetch a raw copy of the prawn for processed versions
raw_path <- paste0(proc_tag,"/PRAWN.csv")
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() #%>%
na_0_prawn
replace_na(na_0_prawn,0)
na_0_prawn %>% replace_na(list(x = 0, y = "unknown"))
na_0_prawn %>% replace(is.na(.),0)
na_0_prawn %>% mutate_all(coalesce,0)
na_0_prawn
na_0_prawn[14]
na_0_prawn[16]
na_0_prawn[15]
na_0_prawn[14]
View(na_0_prawn)
na_0_prawn$`Point sources`
sum(is.na(na_0_prawn$`Point sources`))
#Make a list to tag the columns tro run a replacement on
NamedList <- c("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal")
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(NamedList=replace_na(NamedList,0))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(Agricultural=replace_na(Agricultural,0))
na_0_prawn
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal"),
replace_na(0))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal"),
replace_na)
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal"),
~replace_na(.x,0))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across(c("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal")),
~replace_na(.x,0))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across(c("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal")),
~replace_na(0))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across(c("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal")),
replace_na(0))
na_0_prawn
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across(c("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal")),
replace_na(.x,0))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across(c("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal")),
~replace_na(.x,0))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
mutate(across(c("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal")),
is.na=0)
na_0_prawn
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(across(c("Agricultural","Domestic combustion","Energy production",
"Industrial combustion","Industrial production","Natural",
"Offshore","Other transport and mobile machinery","Road transport","Solvents","Total"
,"Total_no_points","Waste treatment and disposal")),
0)
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(0)
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na("Agricultural"=0,"Domestic combustion"=0,"Energy production"=0,
"Industrial combustion"=0,"Industrial production"=0,"Natural"=0,
"Offshore"=0,"Other transport and mobile machinery"=0,"Road transport"=0,"Solvents"=0,"Total"=0
,"Total_no_points"=0,"Waste treatment and disposal"=0)
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(Agricultural=0,Domestic combustion=0,"Energy production"=0,
"Industrial combustion"=0,"Industrial production"=0,"Natural"=0,
"Offshore"=0,"Other transport and mobile machinery"=0,"Road transport"=0,"Solvents"=0,"Total"=0
,"Total_no_points"=0,"Waste treatment and disposal"=0)
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(Agricultural=0,Domestic combustion=0,'Energy production'=0,
'Industrial combustion'=0,'Industrial production'=0,Natural=0,
Offshore=0,'Other transport and mobile machinery'=0,'Road transport'=0,'Solvents'=0,Total=0
,'Total_no_points'=0,'Waste treatment and disposal'=0)
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(Agricultural=0)
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(list("Agricultural"=0,"Domestic combustion"=0,"Energy production"=0,
"Industrial combustion"=0,"Industrial production"=0,"Natural"=0,
"Offshore"=0,"Other transport and mobile machinery"=0,"Road transport"=0,"Solvents"=0,"Total"=0
,"Total_no_points"=0,"Waste treatment and disposal"=0))
na_0_prawn
setwd("~/GitHub/Data-analysis-with-PRAWNS-demo")
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
iteration="0.3.0")
last_error()
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/na is 0")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(list("Agricultural"=0,"Domestic combustion"=0,"Energy production"=0,
"Industrial combustion"=0,"Industrial production"=0,"Natural"=0,
"Offshore"=0,"Other transport and mobile machinery"=0,"Road transport"=0,"Solvents"=0,"Total"=0
,"Total_no_points"=0,"Waste treatment and disposal"=0))
write.csv(x = na_0_prawn,
file=prawn_path)
if (index==3){
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/na is 0")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(list("Agricultural"=0,"Domestic combustion"=0,"Energy production"=0,
"Industrial combustion"=0,"Industrial production"=0,"Natural"=0,
"Offshore"=0,"Other transport and mobile machinery"=0,"Road transport"=0,"Solvents"=0,"Total"=0
,"Total_no_points"=0,"Waste treatment and disposal"=0))
write.csv(x = na_0_prawn,
file=prawn_path)
}
#Make and save a graph showing a summary of the pollutants
source_breakdown <- source_summary(prawn_path=prawn_path,
pollutant=pollutant,
year=year)
ggsave(filename= paste0(proc_tag,"/",pollutant," source summary.png"),
plot=source_breakdown,
device="png")
#Make and save a graph where the sources are all faceted
source_facets <- faceted_sources(prawn_path = prawn_path,
pollutant=pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted sources.png"),
plot=source_facets,
device="png")
#Make and save a graph showing IMD based inequality for each RUC code
RUC_breakdown <- RUC_IMD(prawn_path = prawn_path,
pollutant=pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," RUC breakdown.png"),
plot=RUC_breakdown[[1]],
device="png")
ggsave(filename= paste0(proc_tag,"/",pollutant," RUC populationbreakdown.png"),
plot=RUC_breakdown[[2]],
device="png")
#Facet the mean and median pollutantlevels by city
city_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted by city.png"),
plot=city_facets,
device="png")
#Facet the mean and median pollutant levels by county/unitary authority
area_facets <- faceted_plot(prawn_path = prawn_path,
group= "TCITY15NM",
pollutant = pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted by area.png"),
plot=area_facets,
device="png")
#Plot the average pollutant vs average IMD grouped by county/ua
avg_imd_pol <- area_IMD_vs_pol(prawn_path=prawn_path,
pollutant = pollutant,
area_type = "Area")
ggsave(filename= paste0(proc_tag,"/",pollutant," average vs average IMD by area.png"),
plot=avg_imd_pol,
device="png")
#calculate and record the difference between the mean and median points and regression lines at deciles 1 and 10
numbers <- stat_wrangler(prawn_path = prawn_path,
deciles=c(1,10))
write.csv(x=numbers,
file=paste0(proc_tag,"/differnce between deciles.csv"))
#close the for loop
}
#close the function
}
prawn_path
View(na_0_prawn)
source("~/GitHub/PRAWNS/R/bulk_processor.R")
#Process PM2.5
bulk_processor(raster_path = "Data/pm2.5_rasters_2019",
shapefile_path = "Data/2011_LSOA_shapefile_20m_generalised",
data_folder = "Data/LSOA_statistics",
pollutant_data_name = "pm2_5",
year = 2019,
pollutant = "PM2.5",
iteration="0.3.0")
proc_tag <- paste0(pollutant,"_emissions_in_",year,"_v",iteration,"/na is 0")
prawn_path <- paste0(proc_tag,"/PRAWN.csv")
#create the folder that everything goes in
dir.create(path=paste0(proc_tag))
#Create the filtered data without London and save it at prawn_path
na_0_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
replace_na(list("Agricultural"=0,"Domestic combustion"=0,"Energy production"=0,
"Industrial combustion"=0,"Industrial production"=0,"Natural"=0,
"Offshore"=0,"Other transport and mobile machinery"=0,"Road transport"=0,"Solvents"=0,"Total"=0
,"Total_no_points"=0,"Waste treatment and disposal"=0))
write.csv(x = na_0_prawn,
file=prawn_path)
warnings()
#Make and save a graph where the sources are all faceted
source_facets <- faceted_sources(prawn_path = prawn_path,
pollutant=pollutant)
ggsave(filename= paste0(proc_tag,"/",pollutant," faceted sources.png"),
plot=source_facets,
device="png")
#Create the filtered data without London and save it at prawn_path
londonless_prawn <- read.csv(raw_path,
row.names=1,
check.names=FALSE) %>%
tibble() %>%
filter(TCITY15NM!="London")
londonless_prawn
sum(is.na(londonless_prawn))
sum(is.na(londonless_prawn&offshore))
sum(is.na(londonless_prawn$offshore))
sum(is.na(londonless_prawn$Offshore))
na_count <-sapply(londonless_prawn, function(y) sum(length(which(is.na(y)))))
na_count
na_count %>% tibble()
na_count[11]
na_count[12]
na_count[13]
na_count[14]
View(bulk_processor)
View(bulk_processor)
View(bulk_processor)
